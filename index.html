<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Codex Vitae</title>
    <link rel="stylesheet" href="CSS/style.css">
    <script type="module" src="https://unpkg.com/@google/model-viewer/dist/model-viewer.min.js"></script>
</head>
<body>

    <div id="auth-screen">
        <h1>Codex Vitae</h1>
        <input type="email" id="email-input" placeholder="Email">
        <input type="password" id="password-input" placeholder="Password">
        <button id="login-btn">Login</button>
        <button id="signup-btn">Sign Up</button>
    </div>

    <div id="app-screen" class="hidden">
        <h2>Welcome to Your Codex</h2>

        <div class="ability-legacy-panel">
            <div id="ability-card" class="widget ability-card" role="region" aria-label="Ability Now">
                <h3>Ability Now</h3>
                <div class="ability-ring" role="img" aria-label="Ability score">
                    <svg viewBox="0 0 120 120" class="ability-ring-svg">
                        <circle class="ability-ring-bg" cx="60" cy="60" r="52"></circle>
                        <circle class="ability-ring-progress" cx="60" cy="60" r="52"></circle>
                    </svg>
                    <div class="ability-ring-label">
                        <span id="ability-score">0</span>
                        <p>of 100</p>
                    </div>
                </div>
                <p class="ability-ring-subtext" id="ability-progress-text">Building your current capability</p>
            </div>

            <div id="legacy-card" class="widget legacy-card" role="region" aria-label="Legacy Progress">
                <h3>Legacy</h3>
                <div class="legacy-level-display">
                    <span class="legacy-level-label">Lvl</span>
                    <span id="legacy-level">0</span>
                    <span class="legacy-level-infinity">∞</span>
                </div>
                <p id="legacy-score" class="legacy-score">Score 0</p>
                <div class="legacy-perk-points">
                    <span>Perk Points</span>
                    <strong id="legacy-perk-points">0</strong>
                </div>
                <div class="legacy-tabs" role="tablist" aria-label="Leaderboards">
                    <button class="legacy-tab active" data-tab="ability" aria-selected="true">Ability (Now)</button>
                    <button class="legacy-tab" data-tab="legacy" aria-selected="false">Legacy (Grind)</button>
                </div>
            </div>
        </div>

        <div class="avatar-hero">
            <div class="avatar-stage">
                <model-viewer
                    id="captured-photo"
                    class="avatar-viewer"
                    src="assets/avatars/codex-vitae-avatar.gltf"
                    alt="Your Avatar"
                    camera-controls
                    auto-rotate
                    interaction-prompt="none"
                    camera-target="0 1.4 0"
                    camera-orbit="0deg 80deg 2.9m"
                    min-camera-orbit="-120deg 60deg 2.6m"
                    max-camera-orbit="120deg 100deg 3.4m"
                    field-of-view="28deg"
                    shadow-intensity="0.65"
                    exposure="1.1"
                ></model-viewer>
                <video id="webcam-feed" class="avatar-camera hidden" autoplay playsinline></video>
            </div>
            <canvas id="photo-canvas" class="hidden"></canvas>
        </div>

        <div id="face-scan-section" class="widget">
            <button id="scan-face-btn">Scan Your Face &amp; Body</button>
        </div>

        <div id="stat-panel" class="widget" role="region" aria-label="Ability stats">
            <h3>Ability Stats</h3>
            <div id="stat-rows" class="stat-rows" aria-live="polite">
                <div class="stat-row" data-stat="pwr">
                    <div class="stat-row-header">
                        <span class="stat-row-label">PWR • Force</span>
                        <span class="stat-row-value" id="pwr-value">--</span>
                    </div>
                    <div class="stat-bar major" role="progressbar" aria-valuemin="1" aria-valuemax="20" aria-valuenow="1">
                        <div class="stat-bar-fill" id="pwr-major-bar"></div>
                        <span class="stat-bar-text" id="pwr-major-text">--</span>
                        <span class="stat-confidence" id="pwr-confidence">Q 0.00</span>
                    </div>
                    <div class="stat-bar legacy" role="progressbar" aria-valuemin="0" aria-valuemax="100" aria-valuenow="0">
                        <div class="stat-bar-fill" id="pwr-legacy-bar"></div>
                        <span class="stat-bar-text" id="pwr-legacy-text">Legacy 0</span>
                    </div>
                </div>
                <div class="stat-row" data-stat="acc">
                    <div class="stat-row-header">
                        <span class="stat-row-label">ACC • Precision</span>
                        <span class="stat-row-value" id="acc-value">--</span>
                    </div>
                    <div class="stat-bar major" role="progressbar" aria-valuemin="1" aria-valuemax="20" aria-valuenow="1">
                        <div class="stat-bar-fill" id="acc-major-bar"></div>
                        <span class="stat-bar-text" id="acc-major-text">--</span>
                        <span class="stat-confidence" id="acc-confidence">Q 0.00</span>
                    </div>
                    <div class="stat-bar legacy" role="progressbar" aria-valuemin="0" aria-valuemax="100" aria-valuenow="0">
                        <div class="stat-bar-fill" id="acc-legacy-bar"></div>
                        <span class="stat-bar-text" id="acc-legacy-text">Legacy 0</span>
                    </div>
                </div>
                <div class="stat-row" data-stat="grt">
                    <div class="stat-row-header">
                        <span class="stat-row-label">GRT • Resilience</span>
                        <span class="stat-row-value" id="grt-value">--</span>
                    </div>
                    <div class="stat-bar major" role="progressbar" aria-valuemin="1" aria-valuemax="20" aria-valuenow="1">
                        <div class="stat-bar-fill" id="grt-major-bar"></div>
                        <span class="stat-bar-text" id="grt-major-text">--</span>
                        <span class="stat-confidence" id="grt-confidence">Q 0.00</span>
                    </div>
                    <div class="stat-bar legacy" role="progressbar" aria-valuemin="0" aria-valuemax="100" aria-valuenow="0">
                        <div class="stat-bar-fill" id="grt-legacy-bar"></div>
                        <span class="stat-bar-text" id="grt-legacy-text">Legacy 0</span>
                    </div>
                </div>
                <div class="stat-row" data-stat="cog">
                    <div class="stat-row-header">
                        <span class="stat-row-label">COG • Intellect</span>
                        <span class="stat-row-value" id="cog-value">--</span>
                    </div>
                    <div class="stat-bar major" role="progressbar" aria-valuemin="1" aria-valuemax="20" aria-valuenow="1">
                        <div class="stat-bar-fill" id="cog-major-bar"></div>
                        <span class="stat-bar-text" id="cog-major-text">--</span>
                        <span class="stat-confidence" id="cog-confidence">Q 0.00</span>
                    </div>
                    <div class="stat-bar legacy" role="progressbar" aria-valuemin="0" aria-valuemax="100" aria-valuenow="0">
                        <div class="stat-bar-fill" id="cog-legacy-bar"></div>
                        <span class="stat-bar-text" id="cog-legacy-text">Legacy 0</span>
                    </div>
                </div>
                <div class="stat-row" data-stat="pln">
                    <div class="stat-row-header">
                        <span class="stat-row-label">PLN • Foresight</span>
                        <span class="stat-row-value" id="pln-value">--</span>
                    </div>
                    <div class="stat-bar major" role="progressbar" aria-valuemin="1" aria-valuemax="20" aria-valuenow="1">
                        <div class="stat-bar-fill" id="pln-major-bar"></div>
                        <span class="stat-bar-text" id="pln-major-text">--</span>
                        <span class="stat-confidence" id="pln-confidence">Q 0.00</span>
                    </div>
                    <div class="stat-bar legacy" role="progressbar" aria-valuemin="0" aria-valuemax="100" aria-valuenow="0">
                        <div class="stat-bar-fill" id="pln-legacy-bar"></div>
                        <span class="stat-bar-text" id="pln-legacy-text">Legacy 0</span>
                    </div>
                </div>
                <div class="stat-row" data-stat="soc">
                    <div class="stat-row-header">
                        <span class="stat-row-label">SOC • Influence</span>
                        <span class="stat-row-value" id="soc-value">--</span>
                    </div>
                    <div class="stat-bar major" role="progressbar" aria-valuemin="1" aria-valuemax="20" aria-valuenow="1">
                        <div class="stat-bar-fill" id="soc-major-bar"></div>
                        <span class="stat-bar-text" id="soc-major-text">--</span>
                        <span class="stat-confidence" id="soc-confidence">Q 0.00</span>
                    </div>
                    <div class="stat-bar legacy" role="progressbar" aria-valuemin="0" aria-valuemax="100" aria-valuenow="0">
                        <div class="stat-bar-fill" id="soc-legacy-bar"></div>
                        <span class="stat-bar-text" id="soc-legacy-text">Legacy 0</span>
                    </div>
                </div>
            </div>
        </div>

        <div id="maintenance-card" class="widget maintenance-card" role="region" aria-live="polite">
            <h3>Atrophy &amp; Maintenance</h3>
            <p id="maintenance-message">Loading personalized guidance…</p>
        </div>

        <div id="perk-panel" class="widget" role="region" aria-label="Perks">
            <h3>Perks</h3>
            <div id="perk-chips" class="perk-chip-row" aria-live="polite">
                <p class="empty-state">No perks yet. Earn Legacy points to unlock them.</p>
            </div>
        </div>

        <div id="chore-section" class="widget">
            <h4>Chore Effort</h4>
            <p class="widget-subtitle">Complete chores to gain Stat Fragments. 1,000 Fragments = +1 Stat Point.</p>

            <div id="chore-progress-grid">
                <div class="chore-stat-tracker">
                    <div class="flex-between">
                        <p class="chore-stat-label">Strength</p>
                        <p class="chore-fragment-text" id="strength-chore-text">0 / 1000</p>
                    </div>
                    <div class="progress-bar-container">
                        <div id="strength-chore-bar" class="progress-bar"></div>
                    </div>
                </div>
                <div class="chore-stat-tracker">
                    <div class="flex-between">
                        <p class="chore-stat-label">Dexterity</p>
                        <p class="chore-fragment-text" id="dexterity-chore-text">0 / 1000</p>
                    </div>
                    <div class="progress-bar-container">
                        <div id="dexterity-chore-bar" class="progress-bar"></div>
                    </div>
                </div>
                <div class="chore-stat-tracker">
                    <div class="flex-between">
                        <p class="chore-stat-label">Constitution</p>
                        <p class="chore-fragment-text" id="constitution-chore-text">0 / 1000</p>
                    </div>
                    <div class="progress-bar-container">
                        <div id="constitution-chore-bar" class="progress-bar"></div>
                    </div>
                </div>
                <div class="chore-stat-tracker">
                    <div class="flex-between">
                        <p class="chore-stat-label">Intelligence</p>
                        <p class="chore-fragment-text" id="intelligence-chore-text">0 / 1000</p>
                    </div>
                    <div class="progress-bar-container">
                        <div id="intelligence-chore-bar" class="progress-bar"></div>
                    </div>
                </div>
                <div class="chore-stat-tracker">
                    <div class="flex-between">
                        <p class="chore-stat-label">Wisdom</p>
                        <p class="chore-fragment-text" id="wisdom-chore-text">0 / 1000</p>
                    </div>
                    <div class="progress-bar-container">
                        <div id="wisdom-chore-bar" class="progress-bar"></div>
                    </div>
                </div>
                <div class="chore-stat-tracker">
                    <div class="flex-between">
                        <p class="chore-stat-label">Charisma</p>
                        <p class="chore-fragment-text" id="charisma-chore-text">0 / 1000</p>
                    </div>
                    <div class="progress-bar-container">
                        <div id="charisma-chore-bar" class="progress-bar"></div>
                    </div>
                </div>
            </div>

            <div id="add-chore-input-group" class="input-group">
                <input type="text" id="chore-input" placeholder="Log a completed chore and press Enter...">
            </div>

            <ul id="chore-list"></ul>
        </div>

        <div id="activity-log-section" class="widget">
            <h4>Log a Quick Stat Gain</h4>
            <div class="input-group">
                <select id="activity-select">
                    <option value="strength">+1 Strength</option>
                    <option value="dexterity">+1 Dexterity</option>
                    <option value="constitution">+1 Constitution</option>
                    <option value="intelligence">+1 Intelligence</option>
                    <option value="wisdom">+1 Wisdom</option>
                    <option value="charisma">+1 Charisma</option>
                </select>
                <button id="log-activity-btn">Log</button>
            </div>
        </div>

        <button id="open-codex-btn">Open Codex</button>
    </div>

    <div id="onboarding-modal" class="modal hidden">
        <div class="modal-content">
            <h2>Create Your Character</h2>
            <p>Answer a few questions to establish your baseline stats.</p>
            <form id="onboarding-form">
                <label>How often do you do intense exercise?</label>
                <select id="exercise-freq">
                    <option value="0">Rarely or Never</option>
                    <option value="1">1-2 times a week</option>
                    <option value="2">3-4 times a week</option>
                </select>
                <label>How often do you actively learn something new?</label>
                <select id="study-habit">
                    <option value="0">Rarely</option>
                    <option value="1">Sometimes</option>
                    <option value="2">Often</option>
                </select>
                <button type="submit">Finalize Character</button>
            </form>
        </div>
    </div>

    <div id="skills-modal" class="modal hidden">
        <div class="modal-content">
            <div id="skill-tree-header">
                <button id="skill-back-btn" class="hidden" type="button">&larr; Back</button>
                <h2 id="skill-tree-title">Skill Universe</h2>
                <div class="skill-tree-controls">
                    <form id="skill-search-form" class="skill-tree-search" role="search">
                        <input
                            type="search"
                            id="skill-search-input"
                            placeholder="Search galaxy, constellation, or star..."
                            aria-label="Search skills"
                            autocomplete="off"
                        >
                        <button type="submit" id="skill-search-button">Search</button>
                    </form>
                    <div id="skill-tree-pan-controls" class="hidden" role="group" aria-label="Constellation pan controls">
                        <button id="skill-pan-left" class="skill-tree-pan-button" type="button" aria-label="Nudge constellations left">&#8592;</button>
                        <button id="skill-pan-right" class="skill-tree-pan-button" type="button" aria-label="Nudge constellations right">&#8594;</button>
                    </div>
                    <button id="close-skills-btn" type="button">Close</button>
                </div>
            </div>
            <div id="skill-tree-breadcrumbs"></div>
            <div id="skill-tree-canvas-container"></div>
            <div id="star-detail-panel" class="hidden">
                <div class="star-detail-header">
                    <div class="star-detail-title-group">
                        <div id="star-detail-art" class="star-detail-art" aria-hidden="true"></div>
                        <div class="star-detail-text">
                            <h3 id="star-detail-title"></h3>
                            <p id="star-detail-location" class="star-detail-location"></p>
                        </div>
                    </div>
                    <button id="star-detail-close" type="button" aria-label="Close star details">&times;</button>
                </div>
                <p id="star-detail-description" class="star-detail-description"></p>
                <div id="star-detail-requirements" class="star-detail-requirements"></div>
                <div id="star-detail-actions" class="star-detail-actions">
                    <button id="star-unlock-btn" type="button">Unlock</button>
                    <button id="star-proof-btn" type="button">Provide Proof</button>
                </div>
            </div>
        </div>
    </div>

    <div id="codex-modal" class="modal hidden">
        <div class="modal-content">
            <h2>Codex Menu</h2>
            <div class="codex-menu">
                <button id="codex-skills-btn">Constellation Skills</button>
                <button id="codex-logout-btn">Logout</button>
            </div>
            <button id="close-codex-btn">Close</button>
        </div>
    </div>
    
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-auth.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-firestore.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-storage.js"></script>

    <script src="js/vendor/three.min.js"></script>
    <script src="js/vendor/OrbitControls.js"></script>

    <script src="js/skill-tree-data.js"></script>
    <script src="js/skill-universe-renderer.js"></script>
    <!-- Configuration values (firebase config, backend URL) -->
    <script src="config.js"></script>
    <script src="js/main.js"></script>
</body>
</html>
