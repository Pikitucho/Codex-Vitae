<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Codex Vitae</title>
    <link rel="stylesheet" href="CSS/style.css">
</head>
<body>

    <div id="auth-screen">
        <h1>Codex Vitae</h1>
        <input type="email" id="email-input" placeholder="Email">
        <input type="password" id="password-input" placeholder="Password">
        <button id="login-btn">Login</button>
        <button id="signup-btn">Sign Up</button>
    </div>

    <div id="app-screen" class="hidden">
        <h2>Welcome to Your Codex</h2>

        <div id="level-xp-display" class="widget">
            <div class="flex-between">
                <p>Level <span id="level-value">1</span></p>
                <p id="xp-text">0 / 10 Stats</p>
            </div>
            <div class="progress-bar-container">
                <div id="xp-bar" class="progress-bar"></div>
            </div>
        </div>
        
        <div id="perk-point-display" class="widget">
            <div class="flex-between">
                <h3>Perk Points: <span id="pp-total">0</span></h3>
            </div>
            
            <div class="milestone-progress">
                <div class="flex-between">
                    <p class="milestone-label">Level Milestone</p>
                    <p id="level-milestone-text">0 / 10</p>
                </div>
                <div class="progress-bar-container">
                    <div id="level-milestone-bar" class="progress-bar"></div>
                </div>
            </div>

            <div class="milestone-progress">
                <div class="flex-between">
                    <p class="milestone-label">Monthly Milestone</p>
                    <p id="monthly-milestone-text">0 / 25 Days</p>
                </div>
                <div class="progress-bar-container">
                    <div id="monthly-milestone-bar" class="progress-bar"></div>
                </div>
            </div>
        </div>

        <div id="face-scan-section" class="widget">
            <div class="avatar-display">
                <video id="webcam-feed" class="avatar-circle hidden" autoplay playsinline></video>
                <img id="captured-photo" class="avatar-circle" alt="Your Avatar">
            </div>
            <canvas id="photo-canvas" class="hidden"></canvas>
            <button id="scan-face-btn">Create Avatar</button>
        </div>

        <div id="dashboard" class="widget">
            <h3>Core Stats</h3>
            <div class="dashboard-grid">
                <div class="stat-card">
                    <p class="stat-label">Strength</p>
                    <p id="str-value" class="stat-value">--</p>
                </div>
                <div class="stat-card">
                    <p class="stat-label">Dexterity</p>
                    <p id="dex-value" class="stat-value">--</p>
                </div>
                <div class="stat-card">
                    <p class="stat-label">Constitution</p>
                    <p id="con-value" class="stat-value">--</p>
                </div>
                <div class="stat-card">
                    <p class="stat-label">Intelligence</p>
                    <p id="int-value" class="stat-value">--</p>
                </div>
                <div class="stat-card">
                    <p class="stat-label">Wisdom</p>
                    <p id="wis-value" class="stat-value">--</p>
                </div>
                <div class="stat-card">
                    <p class="stat-label">Charisma</p>
                    <p id="cha-value" class="stat-value">--</p>
                </div>
            </div>
        </div>

        <div id="chore-section" class="widget">
            <h4>Chore Effort</h4>
            <p class="widget-subtitle">Complete chores to gain Stat Fragments. 1,000 Fragments = +1 Stat Point.</p>
            
            <div id="chore-progress-grid">
                <div class="chore-stat-tracker">
                    <div class="flex-between">
                        <p class="chore-stat-label">Strength</p>
                        <p class="chore-fragment-text" id="strength-chore-text">0 / 1000</p>
                    </div>
                    <div class="progress-bar-container">
                        <div id="strength-chore-bar" class="progress-bar"></div>
                    </div>
                </div>
                <div class="chore-stat-tracker">
                    <div class="flex-between">
                        <p class="chore-stat-label">Dexterity</p>
                        <p class="chore-fragment-text" id="dexterity-chore-text">0 / 1000</p>
                    </div>
                    <div class="progress-bar-container">
                        <div id="dexterity-chore-bar" class="progress-bar"></div>
                    </div>
                </div>
                <div class="chore-stat-tracker">
                    <div class="flex-between">
                        <p class="chore-stat-label">Constitution</p>
                        <p class="chore-fragment-text" id="constitution-chore-text">0 / 1000</p>
                    </div>
                    <div class="progress-bar-container">
                        <div id="constitution-chore-bar" class="progress-bar"></div>
                    </div>
                </div>
                <div class="chore-stat-tracker">
                    <div class="flex-between">
                        <p class="chore-stat-label">Intelligence</p>
                        <p class="chore-fragment-text" id="intelligence-chore-text">0 / 1000</p>
                    </div>
                    <div class="progress-bar-container">
                        <div id="intelligence-chore-bar" class="progress-bar"></div>
                    </div>
                </div>
                <div class="chore-stat-tracker">
                    <div class="flex-between">
                        <p class="chore-stat-label">Wisdom</p>
                        <p class="chore-fragment-text" id="wisdom-chore-text">0 / 1000</p>
                    </div>
                    <div class="progress-bar-container">
                        <div id="wisdom-chore-bar" class="progress-bar"></div>
                    </div>
                </div>
                <div class="chore-stat-tracker">
                    <div class="flex-between">
                        <p class="chore-stat-label">Charisma</p>
                        <p class="chore-fragment-text" id="charisma-chore-text">0 / 1000</p>
                    </div>
                    <div class="progress-bar-container">
                        <div id="charisma-chore-bar" class="progress-bar"></div>
                    </div>
                </div>
            </div>

            <div id="add-chore-input-group" class="input-group">
                <input type="text" id="chore-input" placeholder="Log a completed chore and press Enter...">
            </div>
            
            <ul id="chore-list"></ul>
        </div>
        
        <div id="activity-log-section" class="widget">
            <h4>Log a Quick Stat Gain</h4>
            <div class="input-group">
                <select id="activity-select">
                    <option value="strength">+1 Strength</option>
                    <option value="dexterity">+1 Dexterity</option>
                    <option value="constitution">+1 Constitution</option>
                    <option value="intelligence">+1 Intelligence</option>
                    <option value="wisdom">+1 Wisdom</option>
                    <option value="charisma">+1 Charisma</option>
                </select>
                <button id="log-activity-btn">Log</button>
            </div>
        </div>

        <button id="open-codex-btn">Open Codex</button>
    </div>

    <div id="onboarding-modal" class="modal hidden">
        <div class="modal-content">
            <h2>Create Your Character</h2>
            <p>Answer a few questions to establish your baseline stats.</p>
            <form id="onboarding-form">
                <label>How often do you do intense exercise?</label>
                <select id="exercise-freq">
                    <option value="0">Rarely or Never</option>
                    <option value="1">1-2 times a week</option>
                    <option value="2">3-4 times a week</option>
                </select>
                <label>How often do you actively learn something new?</label>
                <select id="study-habit">
                    <option value="0">Rarely</option>
                    <option value="1">Sometimes</option>
                    <option value="2">Often</option>
                </select>
                <button type="submit">Finalize Character</button>
            </form>
        </div>
    </div>

    <div id="skills-modal" class="modal hidden">
        <div class="modal-content">
            <div id="skill-tree-header">
                <button id="skill-back-btn" class="hidden" type="button">&larr; Back</button>
                <h2 id="skill-tree-title">Skill Galaxy</h2>
                <div class="skill-tree-controls">
                    <form id="skill-search-form" class="skill-tree-search" role="search">
                        <input
                            type="search"
                            id="skill-search-input"
                            placeholder="Search galaxy, constellation, or star..."
                            aria-label="Search skills"
                            autocomplete="off"
                        >
                        <button type="submit" id="skill-search-button">Search</button>
                    </form>
                    <div id="skill-tree-pan-controls" class="hidden" role="group" aria-label="Constellation pan controls">
                        <button id="skill-pan-left" class="skill-tree-pan-button" type="button" aria-label="Nudge constellations left">&#8592;</button>
                        <button id="skill-pan-right" class="skill-tree-pan-button" type="button" aria-label="Nudge constellations right">&#8594;</button>
                    </div>
                    <button id="close-skills-btn" type="button">Close</button>
                </div>
            </div>
            <div id="skill-tree-breadcrumbs"></div>
            <div id="skill-tree-canvas-container"></div>
            <div id="star-detail-panel" class="hidden">
                <div class="star-detail-header">
                    <div class="star-detail-title-group">
                        <div id="star-detail-art" class="star-detail-art" aria-hidden="true"></div>
                        <div class="star-detail-text">
                            <h3 id="star-detail-title"></h3>
                            <p id="star-detail-location" class="star-detail-location"></p>
                        </div>
                    </div>
                    <button id="star-detail-close" type="button" aria-label="Close star details">&times;</button>
                </div>
                <p id="star-detail-description" class="star-detail-description"></p>
                <div id="star-detail-requirements" class="star-detail-requirements"></div>
                <div id="star-detail-actions" class="star-detail-actions">
                    <button id="star-unlock-btn" type="button">Unlock</button>
                    <button id="star-proof-btn" type="button">Provide Proof</button>
                </div>
            </div>
        </div>
    </div>

    <div id="codex-modal" class="modal hidden">
        <div class="modal-content">
            <h2>Codex Menu</h2>
            <div class="codex-menu">
                <button id="codex-skills-btn">Constellation Skills</button>
                <button id="codex-logout-btn">Logout</button>
            </div>
            <button id="close-codex-btn">Close</button>
        </div>
    </div>
    
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-auth.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-firestore.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-storage.js"></script>

    <script src="js/vendor/three.min.js"></script>
    <script src="js/vendor/OrbitControls.js"></script>

    <script src="js/skill-tree-data.js"></script>
    <script src="js/skill-universe-renderer.js"></script>
    <!-- Configuration values (firebase config, backend URL) -->
    <script src="config.js"></script>
    <script src="js/main.js"></script>
</body>
</html>
